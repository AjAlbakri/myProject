<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Storytelling Chatbot for Elderly</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles.css') }}">
    <style>
        /* Top Navigation Styles */
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background-color: lightblue;
        }

        nav ul {
            list-style-type: none;
            margin: 0;
            padding: 0;
        }

        nav ul li {
            display: inline;
            margin-right: 20px;
        }

        nav ul li a {
            color: #333;
            text-decoration: none;
            font-size: 18px;
        }

        nav ul li a:hover {
            color: #007bff; /* Change color on hover */
        }

        /* Chat Container Styles */
        .chat-container {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .input-container {
            margin-top: 20px;
        }

        .mic-button {
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 24px;
            cursor: pointer;
        }

        /* Chat Log Styles */
        .chat-log {
            width: 80%;
            height: 300px;
            overflow-y: auto;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #f7f7f8;
            margin-bottom: 20px;
            color: #333; /* Change paragraph color */
        }

        .message {
            margin-bottom: 10px;
            max-width: 70%; /* Limit message width */
        }

        .user-message {
            background-color: #b3d9ff;
            padding: 8px 12px;
            border-radius: 10px;
            color: #333; /* Change user message color */
        }

        .bot-message {
            background-color: #e6e6e6;
            padding: 8px 12px;
            border-radius: 10px;
            color: #333; /* Change bot message color */
        }
    </style>
</head>
<body class="light">

<header class="light" id="header">
    <nav>
        <h1>Welcome to the <span class="chatbot-title">Storytelling Chatbot for Elderly</span></h1>
        <ul class="top-nav">
            <li><a href="/">Home</a></li>
            <li><a href="/about">About</a></li>
            <li><a href="/settings">Settings</a></li>
        </ul>
    </nav>
</header>

<div class="container light">

    <div class="chat-container light">
       
        <div id="chat-log" class="chat-log light"></div>
        <div class="input-container">
            <button onclick="startListening()" class="mic-button">ðŸŽ¤</button>
        </div>
    </div>
</div>

<script>
    var recognition;
    var swearWords = ['fuck', 'shit', 'asshole', 'bitch', 'bastard', 'damn', 'crap', 'ass', 'dick', 'pussy'];
// this function is responsible for initiating speach recognition
// also it checks if the browser support speach recognition/
//webkitSpeechRecognition object and sets various properties like continuous and
//interimResults. Event listeners are then set up to handle different stages of speech recognition
//onstart, onresult, onerror, and onend. When speech recognition starts, the function logs a message. 
//When a result is received, it converts the spoken text to lowercase, checks for swear words, 


    function startListening() {
        if (!('webkitSpeechRecognition' in window)) {
            alert("Speech recognition is not supported by your browser.");
            return;
        }

        recognition = new webkitSpeechRecognition();
        recognition.continuous = false;
        recognition.interimResults = false;

        recognition.onstart = function() {
            console.log("Speech recognition started.");
        };

        recognition.onresult = function(event) {
            var transcript = event.results[0][0].transcript.toLowerCase();
            console.log("User said: ", transcript);
            if (!checkSwearWords(transcript)) {
                sendMessage(transcript);
            } else {
                appendMessage('user', '*** Inappropriate language ***');
                appendMessage('bot', 'Please refrain from using inappropriate language.', []);
            }
        };

        recognition.onerror = function(event) {
            console.error("Speech recognition error:", event.error);
        };

        recognition.onend = function() {
            console.log("Speech recognition ended.");
        };

        recognition.start();
    }

    function stopListening() {
        if (recognition) {
            recognition.stop();
        }
    }

    function sendMessage(message) {
        if (message.trim() !== '') {
            appendMessage('user', message);
      
if (message.toLowerCase().includes('generate images')) {
    generateImages();
} else {
    // this sends user input to flask to get the route 
    fetch('/get', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ msg: message })
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(data => {
        appendMessage('bot', data.response, data.options);
        speak(data.response); // once the bot responses you will be able to hear it 
    })
    .catch(error => {
        console.error('Error:', error);
    });
}
}
}
// this adds new new message to chatlog
    function appendMessage(sender, message, options) {
        var chatLog = document.getElementById('chat-log');
        var messageElement = document.createElement('div');
        messageElement.classList.add('message', sender === 'user' ? 'user-message' : 'bot-message');
        messageElement.textContent = message;
        chatLog.appendChild(messageElement);
        chatLog.scrollTop = chatLog.scrollHeight;
    }
// this returns true if theres a ny swear words
    function checkSwearWords(input) {
        for (var i = 0; i < swearWords.length; i++) {
            if (input.includes(swearWords[i])) {
                return true;
            }
        }
        return false;
    }
</script>


</body>
</html>


